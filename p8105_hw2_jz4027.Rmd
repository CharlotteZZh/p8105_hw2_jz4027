---
title: "p8105_hw2_jz4027"
author: "Charlotte Zhang"
date: "2025-09-26"
output: github_document
---
```{r}
# Load needed library
library(tidyverse)
library(readxl)
library(lubridate)
library(janitor)
```

# Problem 1
### Clean the pols_month data set 
```{r}
pols_month_df = 
  # import and clean pols-month data
  read_csv("./fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  # split mon into year, month, day
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    # convert to integers
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day),
    # replace month number with month name
    month = month.name[month],
    # create a president variable taking values gop and dem
    president = if_else(prez_gop == 1, "gop", "dem")
  ) |>
  # remove three variables
  select(-day, -prez_gop, -prez_dem)

pols_month_df
```

### Clean the snp data set
```{r}
snp_df = 
  # import and clean snp data
  read_csv("./fivethirtyeight_datasets/snp.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  # split date into month, day, year
  separate(date, into = c("month", "day", "year"), sep = "/") |>
  mutate(
    # convert to integers
    year = as.integer(year),
    # Change from 2-integer years to 4-integer
    year = if_else(year > 25, 1900 + year, 2000 + year),
    month = as.integer(month),
    day = as.integer(day),
    # replace month number with month name
    month = month.name[month]) |>
  select (year, month, close) |>
  # arrange according to year and month
  arrange(year, month)

snp_df
```

### Clean the unemployment data set
```{r}
unemployment_df = 
  # import and clean unemployment data
  read_csv("./fivethirtyeight_datasets/unemployment.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |>
  pivot_longer(
    jan:dec,
    names_to = 'month',
    values_to = 'unemployment',
  ) |>
  mutate(
    month = str_to_title(month),            # the first letter of each month is capitalized
    month = match(month, month.abb),        # convert abbreviation â†’ month number
    month = month.name[month]               # convert month number to full month name for format consistency 
  )

unemployment_df
```

### Merge
```{r}
snp_pols_merged_df = 
  left_join(pols_month_df, snp_df, by = c("year", "month"))

unemployment_merged_df =
  left_join(snp_pols_merged_df, unemployment_df, by = c("year", "month"))
unemployment_merged_df
```

### Explain and describe
pols_month csv file contains the number of politicians (sen, rep, gov, prez) affiliated with the GOP and the democratic party each month, throughout many years. It also shows which party hold the presidency by using 0 and 1. Then, the snp data set contains different dates and their corresponding SP closing value. The date column of the snp data set was also reformatted/cleaned for consistency across data sets. The unemployment data set includes monthly unemployment rate from 1948 to 2015, switched from the original wide format (month as column names) to long format for better format consistency. The resulting combined data set has a dimension of `r dim(unemployment_merged_df)` (rows and columns, respectively). It has a year range between `r range(unemployment_merged_df$year)`. Key variables include: `r colnames(unemployment_merged_df)`.

# Problem 2
### Clean and organize data for Mr. Trash Wheel
```{r}
# Clean and organize data for Mr. Trash Wheel
Mr_df = read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N653" ) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(sports_balls = as.integer(round(sports_balls)),
         year = as.integer(year),
         trash_wheel = "mr. trash wheel") 
  
```

### Clean and organize data for Professor Trash Wheel
```{r}
# Clean and organize data for Professor Trash Wheel
Professor_df = read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel") |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(year = as.integer(year),
         trash_wheel = "professor trash wheel")
```

### Clean and organize data for Gwynnda
```{r}
# Clean and organize data for Gwynnda
Gwynnda_df = read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel") |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(year = as.integer(year),
         trash_wheel = "gwynnda trsh wheel")
```

### combine
```{r}
# Combine
P2_combined <- bind_rows(Mr_df, Professor_df, Gwynnda_df)
```

### Description
```{r}
prof_total_weight <- P2_combined |>
  filter(trash_wheel == "professor trash wheel") |>
  summarise(total_weight = sum(weight_tons, na.rm = TRUE)) |>
  pull(total_weight)

gwynnda_june2022_cigarette <- P2_combined |>
  filter(month == "June", year == 2022, trash_wheel == "gwynnda trash wheel") |>
  summarise(total_cig_butts = sum(cigarette_butts, na.rm = TRUE)) |>
  pull(total_cig_butts)
```

The resulting combined trash wheel dataset contains `r nrow(P2_combined)` observations. Each row corresponds to a dumpster removal event, with key variables including the date, weight of trash, volume of trash, the name of the trash wheel, and the counts of specific types of collected litters. Here is a list of all variables in the combined dataset: `r colnames(P2_combined)`. The total weight of trash collected by Professor Trash Wheel is `r prof_total_weight`. The total number of cigarette butts collected by Gwynnda in June of 2022 is `r gwynnda_june2022_cigarette`. 


# Problem 3
```{r}
# Import and read the data sets
zip_codes_df = 
  read_csv("./zillow_data/Zip Codes.csv", na = c("NA", ".", "")) |>
  janitor::clean_names()

zori_df = 
  read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = c("NA", ".", "")) |>
  janitor::clean_names()
```

### Clean zori_df
```{r}
# Clean zori_df
zori_df_cleaned <- zori_df |>
  rename(zip_code = region_name) |>
  # state name is the same thing as state
  select(-state_name) |>
  pivot_longer(
    cols = starts_with("x20"),  
    names_to = "date",
    values_to = "zori") |>
  mutate(date = str_remove(date, "^x"),
         zori = as.numeric(zori),
         county_name = str_remove(county_name, "\\s+County$")) |>
  separate(date, into = c("zori_year", "zori_month", "zori_day"), sep = "_") |>
  relocate(zip_code, county_name) |>
  arrange(zip_code, county_name)
# ?????? |> filter(!is.na(zori))
```

### Clean zip_codes_df
```{r}
# Clean zip_codes_df
zip_codes_df_cleaned <- zip_codes_df |>
  rename(county_name = county) |>
  relocate(zip_code, county_name) |>  
  arrange(zip_code, county_name)
```

### Merged and resulting tidy dataset 
```{r}
# Combine zip_codes_df_cleaned with zori_df_cleaned
p3_merged = left_join(zip_codes_df_cleaned, zori_df_cleaned, by = c("zip_code", "county_name")) |>
  mutate(
    zori_year = as.integer(zori_year),
    zori_month = as.integer(zori_month),
    zori_day = as.integer(zori_day)
  ) |>
  arrange(zip_code, county_name)
```
Description: In the resulting tidy dataset, there are `r nrow(p3_merged)` observations. The number of unique zip codes is `r length(unique(p3_merged$zip_code))`. The number of unique neighborhood is `r length(unique(p3_merged$neighborhood))`.


### Unique zips in zip_codes csv
```{r}
# zip code in zip_codes_df_cleaned only, not zori_df_cleaned
anti_join(zip_codes_df_cleaned, zori_df_cleaned, by = "zip_code") |>
  arrange(neighborhood)
```
There are 171 zip codes that are in the zip_codes dataset but not in the Zillow Rental Price dataset. The most likely reason is that Zillow excludes areas where there are too few rental listings to get a reliable estimate, such as zip code 10475 (North Bronx) and 11362 (Northeast Queens). These two places are highly local/residential with less tourists/commercial businesses which means lower demand of residential house rentals. And places like Queens Jamaica neighborhood are not in the zillow dataset possibly due to them being an industrial/airport zone with few or no residential homes for rent. 


### Covid price drop
```{r}
# covid price drop top 10
jan2020 <- p3_merged |> filter(zori_month == 1, zori_year == 2020)
jan2021 <- p3_merged |> filter(zori_month == 1, zori_year == 2021)
covid_price_comp <- jan2020 |>
  select(zip_code, county_name, neighborhood, zori_2020 = zori) |>
  inner_join(jan2021 |> select(zip_code, zori_2021 = zori), by = "zip_code") |>
  mutate(
    diff = zori_2021 - zori_2020
  ) |>
  arrange(diff) |>
  slice(1:10)
covid_price_comp
```
The ten ZIP codes with the largest rental price drops between January 2020 and January 2021 were all located in New York County (Manhattan). Zip code 10007 in the lower Manhattan neighborhood had the most dramatic Zillow Observed Rent Index drop, from 6334.21 to 5421.614, a difference of about -912.59. These ten zip codes and neighborhoods contain many residential units, but are also considered as touristy, busy, and linked to office employment. During the pandemic, the reduction in tourists and shift to remote work may have reduced the rental demand, which help explain the large price drops.




